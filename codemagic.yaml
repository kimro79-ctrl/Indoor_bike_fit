workflows:
  bike-fit-build:
    name: BikeFit - Build Only
    instance_type: mac_mini_m2
    max_build_duration: 40

    environment:
      flutter: stable
      xcode: latest

    scripts:
      - name: Get dependencies
        script: flutter pub get

      - name: Build Android APK
        script: flutter build apk --release --split-per-abi

      - name: Build Android App Bundle
        script: flutter build appbundle --release

      - name: Build iOS IPA
        script: flutter build ipa --release --export-options-plist=ios/exportOptions.plist

    artifacts:
      - build/**/outputs/**/*.apk
      - build/**/outputs/**/*.aab
      - build/ios/ipa/*.ipa
      - build/ios/ipa/*.dSYM.zip

    publishing:
      email:
        recipients:
          - your@email.com
        notify:
          success: true
          failure: true
